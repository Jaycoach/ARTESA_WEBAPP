<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 900">
  <!-- Fondo y Título -->
  <rect width="1100" height="900" fill="#f8f9fa" />
  <text x="550" y="40" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle">Arquitectura de LA ARTESA Web App (v1.3.0)</text>
  
  <!-- Leyenda -->
  <g transform="translate(920, 100)">
    <text x="0" y="0" font-family="Arial" font-size="14" font-weight="bold">Leyenda</text>
    
    <!-- Componentes -->
    <rect x="0" y="10" width="20" height="20" fill="#a7c0e3" stroke="#5b81c1" stroke-width="2" />
    <text x="30" y="25" font-family="Arial" font-size="12">Middleware</text>
    
    <rect x="0" y="40" width="20" height="20" fill="#9ed9b5" stroke="#50a878" stroke-width="2" />
    <text x="30" y="55" font-family="Arial" font-size="12">Controladores</text>
    
    <rect x="0" y="70" width="20" height="20" fill="#fff19e" stroke="#dfb100" stroke-width="2" />
    <text x="30" y="85" font-family="Arial" font-size="12">Servicios</text>
    
    <rect x="0" y="100" width="20" height="20" fill="#ffb6c1" stroke="#e77c8d" stroke-width="2" />
    <text x="30" y="115" font-family="Arial" font-size="12">Modelos</text>
    
    <rect x="0" y="130" width="20" height="20" fill="#c2a5df" stroke="#8a5cba" stroke-width="2" />
    <text x="30" y="145" font-family="Arial" font-size="12">Config / Utilidades</text>
    
    <rect x="0" y="160" width="20" height="20" fill="#f8d9ac" stroke="#e8ae67" stroke-width="2" />
    <text x="30" y="175" font-family="Arial" font-size="12">Rutas</text>
    
    <rect x="0" y="190" width="20" height="20" fill="#b3e6ff" stroke="#4da6ff" stroke-width="2" />
    <text x="30" y="205" font-family="Arial" font-size="12">Sistemas Externos</text>
    
    <!-- Flechas -->
    <line x1="0" y1="230" x2="30" y2="230" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
    <text x="40" y="235" font-family="Arial" font-size="12">Flujo de datos</text>
    
    <line x1="0" y1="260" x2="30" y2="260" stroke="#666" stroke-width="1" stroke-dasharray="5,3" />
    <text x="40" y="265" font-family="Arial" font-size="12">Dependencia</text>
    
    <line x1="0" y1="290" x2="30" y2="290" stroke="#39c" stroke-width="2" />
    <text x="40" y="295" font-family="Arial" font-size="12">API Externa</text>
  </g>
  
  <!-- Definición de marcadores -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
    <marker id="blueArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#39c" />
    </marker>
  </defs>
  
  <!-- Componentes de la aplicación -->
  
  <!-- Cliente -->
  <rect x="80" y="100" width="120" height="60" rx="10" ry="10" fill="#f0f0f0" stroke="#333" stroke-width="2" />
  <text x="140" y="137" font-family="Arial" font-size="14" text-anchor="middle">Cliente</text>
  
  <!-- Express App -->
  <rect x="300" y="100" width="500" height="60" rx="10" ry="10" fill="#e0e0e0" stroke="#333" stroke-width="2" />
  <text x="550" y="137" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Express App (app.js)</text>
  
  <!-- Middleware -->
  <rect x="300" y="200" width="500" height="110" rx="10" ry="10" fill="#a7c0e3" stroke="#5b81c1" stroke-width="2" />
  <text x="550" y="220" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Middleware</text>
  <text x="550" y="245" font-family="Arial" font-size="12" text-anchor="middle">Auth, Security, ErrorHandling, RateLimit, TokenRevocation</text>
  <text x="550" y="265" font-family="Arial" font-size="12" text-anchor="middle">Validation, Sanitization, AuditMiddleware, EnhancedSecurity</text>
  <text x="550" y="285" font-family="Arial" font-size="12" text-anchor="middle">PaymentSanitization, EnsureJsonResponse</text>
  
  <!-- Rutas -->
  <rect x="300" y="350" width="500" height="70" rx="10" ry="10" fill="#f8d9ac" stroke="#e8ae67" stroke-width="2" />
  <text x="550" y="375" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Rutas (Routes)</text>
  <text x="550" y="395" font-family="Arial" font-size="10" text-anchor="middle">authRoutes, userRoutes, productRoutes, orderRoutes, clientProfileRoutes, </text>
  <text x="550" y="410" font-family="Arial" font-size="10" text-anchor="middle">passwordResetRoutes, paymentRoutes, uploadRoutes, sapSyncRoutes</text>
  
  <!-- Controladores -->
  <rect x="300" y="460" width="500" height="80" rx="10" ry="10" fill="#9ed9b5" stroke="#50a878" stroke-width="2" />
  <text x="550" y="480" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Controladores</text>
  <text x="550" y="500" font-family="Arial" font-size="10" text-anchor="middle">authController, userController, productController, orderController, </text>
  <text x="550" y="515" font-family="Arial" font-size="10" text-anchor="middle">clientProfileController, passwordResetController, sapSyncController, uploadController</text>
  
  <!-- Servicios -->
  <g>
    <rect x="120" y="460" width="120" height="60" rx="10" ry="10" fill="#fff19e" stroke="#dfb100" stroke-width="2" />
    <text x="180" y="490" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">EmailService</text>
  </g>
  
  <g>
    <rect x="120" y="540" width="120" height="60" rx="10" ry="10" fill="#fff19e" stroke="#dfb100" stroke-width="2" />
    <text x="180" y="570" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">AuditService</text>
  </g>
  
  <g>
    <rect x="120" y="620" width="120" height="60" rx="10" ry="10" fill="#fff19e" stroke="#dfb100" stroke-width="2" />
    <text x="180" y="650" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">S3Service</text>
  </g>
  
  <g>
    <rect x="120" y="700" width="120" height="60" rx="10" ry="10" fill="#fff19e" stroke="#dfb100" stroke-width="2" />
    <text x="180" y="730" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">SapIntegration</text>
    <text x="180" y="745" font-family="Arial" font-size="10" font-weight="bold" text-anchor="middle">Service</text>
  </g>
  
  <!-- Modelos -->
  <rect x="300" y="580" width="500" height="80" rx="10" ry="10" fill="#ffb6c1" stroke="#e77c8d" stroke-width="2" />
  <text x="550" y="605" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Modelos</text>
  <text x="550" y="625" font-family="Arial" font-size="10" text-anchor="middle">User, Product, Order, ClientProfile, PasswordReset, Roles, ProductImage</text>
  <text x="550" y="640" font-family="Arial" font-size="10" text-anchor="middle">Transacciones, Auditoría, Tokens</text>
  
  <!-- Base de Datos -->
  <g>
    <path d="M440,740 C440,760 650,760 650,740 L650,700 C650,680 440,680 440,700 Z" fill="#d0d0d0" stroke="#333" stroke-width="2" />
    <path d="M440,700 C440,720 650,720 650,700" fill="none" stroke="#333" stroke-width="1" />
    <text x="545" y="710" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">PostgreSQL</text>
    <text x="545" y="730" font-family="Arial" font-size="10" text-anchor="middle">users, products, orders, client_profiles, transaction_audit_log, etc.</text>
  </g>
  
  <!-- Utilities -->
  <g>
    <rect x="840" y="460" width="120" height="60" rx="10" ry="10" fill="#c2a5df" stroke="#8a5cba" stroke-width="2" />
    <text x="900" y="490" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Logger</text>
  </g>
  
  <g>
    <rect x="840" y="540" width="120" height="60" rx="10" ry="10" fill="#c2a5df" stroke="#8a5cba" stroke-width="2" />
    <text x="900" y="570" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Database Utils</text>
  </g>
  
  <g>
    <rect x="840" y="620" width="120" height="60" rx="10" ry="10" fill="#c2a5df" stroke="#8a5cba" stroke-width="2" />
    <text x="900" y="650" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">S3UrlManager</text>
  </g>
  
  <!-- Sistemas Externos -->
  
  <!-- AWS S3 -->
  <rect x="840" y="740" width="120" height="60" rx="10" ry="10" fill="#b3e6ff" stroke="#4da6ff" stroke-width="2" />
  <text x="900" y="765" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">AWS S3</text>
  <text x="900" y="780" font-family="Arial" font-size="10" text-anchor="middle">Almacenamiento</text>
  
  <!-- SAP B1 -->
  <rect x="280" y="820" width="180" height="60" rx="10" ry="10" fill="#b3e6ff" stroke="#4da6ff" stroke-width="2" />
  <text x="370" y="850" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">SAP Business One</text>
  <text x="370" y="865" font-family="Arial" font-size="10" text-anchor="middle">Service Layer</text>
  
  <!-- SMTP Server -->
  <rect x="500" y="820" width="180" height="60" rx="10" ry="10" fill="#b3e6ff" stroke="#4da6ff" stroke-width="2" />
  <text x="590" y="850" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">SMTP Server</text>
  <text x="590" y="865" font-family="Arial" font-size="10" text-anchor="middle">Correo Electrónico</text>
  
  <!-- File System (Local Storage) -->
  <rect x="700" y="820" width="180" height="60" rx="10" ry="10" fill="#b3e6ff" stroke="#4da6ff" stroke-width="2" />
  <text x="790" y="850" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">File System</text>
  <text x="790" y="865" font-family="Arial" font-size="10" text-anchor="middle">Almacenamiento Local</text>

  <!-- Relaciones / Flujo de datos -->

  <!-- Cliente a Express -->
  <line x1="200" y1="130" x2="280" y2="130" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <text x="240" y="120" font-family="Arial" font-size="10" text-anchor="middle">HTTP</text>
  
  <!-- Express a Middleware -->
  <line x1="550" y1="160" x2="550" y2="190" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Middleware a Rutas -->
  <line x1="550" y1="310" x2="550" y2="340" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Rutas a Controladores -->
  <line x1="550" y1="420" x2="550" y2="450" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Controladores a Modelos -->
  <line x1="550" y1="540" x2="550" y2="570" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Controladores a Servicios -->
  <line x1="300" y1="500" x2="250" y2="490" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="300" y1="510" x2="250" y2="550" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="300" y1="520" x2="250" y2="630" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="300" y1="530" x2="250" y2="710" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Modelos a Base de Datos -->
  <line x1="550" y1="660" x2="550" y2="680" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Utilidades conexiones -->
  <line x1="840" y1="490" x2="810" y2="490" stroke="#666" stroke-width="1" stroke-dasharray="5,3" />
  <line x1="840" y1="570" x2="810" y2="570" stroke="#666" stroke-width="1" stroke-dasharray="5,3" />
  <line x1="840" y1="650" x2="810" y2="650" stroke="#666" stroke-width="1" stroke-dasharray="5,3" />
  
  <!-- Servicios a Base de Datos -->
  <line x1="180" y1="600" x2="180" y2="660" stroke="#333" stroke-width="2" />
  <line x1="180" y1="700" x2="430" y2="700" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- SapIntegrationService a SAP B1 -->
  <line x1="180" y1="760" x2="180" y2="850" stroke="#39c" stroke-width="2" marker-end="url(#blueArrow)" />
  <line x1="180" y1="850" x2="270" y2="850" stroke="#39c" stroke-width="2" marker-end="url(#blueArrow)" />
  
  <!-- EmailService a SMTP -->
  <line x1="150" y1="520" x2="150" y2="850" stroke="#39c" stroke-width="2" />
  <line x1="150" y1="850" x2="490" y2="850" stroke="#39c" stroke-width="2" marker-end="url(#blueArrow)" />
  
  <!-- S3Service a AWS S3 -->
  <line x1="240" y1="650" x2="900" y2="650" stroke="#39c" stroke-width="2" />
  <line x1="900" y1="650" x2="900" y2="730" stroke="#39c" stroke-width="2" marker-end="url(#blueArrow)" />
  
  <!-- S3Service a File System -->
  <line x1="240" y1="650" x2="250" y2="650" stroke="#39c" stroke-width="2" />
  <line x1="250" y1="650" x2="250" y2="850" stroke="#39c" stroke-width="2" />
  <line x1="250" y1="850" x2="695" y2="850" stroke="#39c" stroke-width="2" marker-end="url(#blueArrow)" />
  
  <!-- Flujo de respuesta -->
  <line x1="480" y1="160" x2="480" y2="310" stroke="#666" stroke-width="1" stroke-dasharray="5,3" transform="translate(-20, 0)" />
  <line x1="480" y1="420" x2="480" y2="540" stroke="#666" stroke-width="1" stroke-dasharray="5,3" transform="translate(-20, 0)" />
  <line x1="480" y1="660" x2="480" y2="540" stroke="#666" stroke-width="1" stroke-dasharray="5,3" transform="translate(-20, 0)" />
  <line x1="280" y1="140" x2="210" y2="140" stroke="#666" stroke-width="1" stroke-dasharray="5,3" />
  <text x="240" y="155" font-family="Arial" font-size="10" text-anchor="middle">JSON/HTTP</text>
  
  <!-- Capas principales -->
  <text x="50" y="250" font-family="Arial" font-size="16" font-weight="bold" transform="rotate(-90, 50, 250)">Capa de Presentación</text>
  <text x="50" y="500" font-family="Arial" font-size="16" font-weight="bold" transform="rotate(-90, 50, 500)">Capa de Negocio</text>
  <text x="50" y="700" font-family="Arial" font-size="16" font-weight="bold" transform="rotate(-90, 50, 700)">Capa de Datos</text>
  <text x="50" y="850" font-family="Arial" font-size="16" font-weight="bold" transform="rotate(-90, 50, 850)">Servicios Externos</text>
  
  <!-- Notas explicativas -->
  <g transform="translate(700, 180)">
    <rect x="0" y="0" width="180" height="110" rx="5" ry="5" fill="#ffffcc" stroke="#ccc" stroke-width="1" />
    <text x="10" y="20" font-family="Arial" font-size="12" font-weight="bold">Nuevos componentes (v1.3.0):</text>
    <text x="10" y="40" font-family="Arial" font-size="10">• Integración con AWS S3</text>
    <text x="10" y="55" font-family="Arial" font-size="10">• Service Layer de SAP B1</text>
    <text x="10" y="70" font-family="Arial" font-size="10">• Perfiles de clientes extendidos</text>
    <text x="10" y="85" font-family="Arial" font-size="10">• Sistema de auditoría avanzado</text>
    <text x="10" y="100" font-family="Arial" font-size="10">• Almacenamiento dual (S3/local)</text>
  </g>
</svg>